{% extends 'app/base_app.html' %}
{% load staticfiles %}
{% block title %} Lista de productos {% endblock %}

{%  block content %}

<ul class="breadcrumb breadcrumbStyle">
  <li class="breadcrumb-item"><i class="fas fa-carrot"></i> Productos</li>
  <li class="breadcrumb-item active">Lista de productos</li>
</ul>

<h1 class="mt-4 text-center titleIniBox"><i class="fas fa-carrot"></i> Lista de productos</h1>

<br>

<div class="table-responsive tableResStyle">
 <table class="table table-striped table-bordered table-striped">
    <thead class="theadStyle">
      <tr>
        <!-- <th>Código</th> -->
        <th>Nombre</th>
        <th>Stock</th>
        <th>Costo</th>
        <th>Venta</th>
        <th>Imagen</th>
        <!-- <th>Proveedor Inicial</th> -->
        <th>Descripción</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody class="text-center">
    {% for row in negocio_producto %}
      <tr>
        <!-- <td>{{ row.producto_id.codigo }}</td> -->
        <td>{{ row.producto_id.nombre }}</td>
        <td>{{ row.producto_id.stock }}</td>
        <td>$ {{ row.producto_id.valor_costo }}</td>
        <td>$ {{ row.producto_id.valor_venta }}</td>
        {% if row.producto_id.imagen %}
        <td> <img src="/media/{{ row.producto_id.imagen }}" class="img-fluid" style="max-width: 150px; max-height: 120px;">  </td>
        {% else %}
        <td> <img src="{% static 'img/nofoto.png' %}" class="img-fluid" style="max-width: 50px;"> </td>
        {% endif %}
        <!-- <td>{{ row.proveedor_id.razon_social }}</td> -->
        <td>{{ row.producto_id.descripcion }}</td>
        <td>
          <a class="btn btn-green btn-sm" href="{% url 'detalle_producto' pk=row.producto_id.id %}" > Detalles </a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center bg-warning">No hay productos registrados</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

  <!-- Modal Editar -->
  <div class="modal fade" id="eliminarmodal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
              <h4 class="modal-title">Eliminar Producto</h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">

              <div id="id_p2" hidden="false"></div>
              <p id="mensaje2"></p>
              <button class="save btn btn-danger" type="submit" onclick="Eliminar()">Eliminar</button> <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>

            </div>

      </div>
    </div>
  </div>

 {% endblock %}

 {% block javascript %}
 <script>

function datos2(id) {
    console.log(id);
    var csrftoken = '{{ csrf_token }}';
    $.ajax({
      headers: {'X-CSRF-TOKEN': csrftoken},
      method: "GET",
      url: '/productos/eliminar/'+id+'/',
      dataType: 'json',
      data: { "csrfmiddlewaretoken": csrftoken,
          "id": id }
    })

    .done(function(response){
      console.log(response);
      var res = response;

      $('#id_p2').text(res.id);
      $('#mensaje2').text('¿Está seguro que desea eliminar el producto ' + res.nombre + ' ?');

    });
}

function Eliminar() {
    var id2 = $("#id_p2").text();
    console.log(id2);
    var csrftoken = '{{ csrf_token }}';
    $.ajax({
      headers: {'X-CSRF-TOKEN': csrftoken},
      method: "POST",
      url: '/productos/eliminar/'+id2+'/',
      dataType: 'text',
      data: { "csrfmiddlewaretoken": csrftoken,
          "id": id2 },
      success:function(data){
          alert('Se eliminó con éxito');
          location.reload();
      },
      error: function(xhr, e, x, status) {
        console.log(xhr.status + " -- " + status + " -- " + e + " -- " + x);
        alert('Ha ocurrido un error, porfavor vuelva a intentar');
      }
    })
  }

</script>
 {% endblock %}
