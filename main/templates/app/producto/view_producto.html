{% extends 'app/base_app.html' %}
{% load staticfiles %}
{% block title %} Inicio {% endblock %}

{%  block content %}

 <h1 class="mt-4">Lista de proveedores</h1>

 <table class="table table-striped table-bordered">

 	<br>
    <thead>
      <tr>
        <th>Código</th>
        <th>Nombre</th>
        <th>Stock</th>
        <th>Valor costo</th>
        <th>Valor venta</th>
        <th>Imagen</th>
        <th>Proveedor</th>
        <th>Descripción</th>
        <th>Acciones</th>
      </tr>
    </thead>
    {% for row in usuario_producto %}
    <tbody>
      <tr>
        <td>{{ row.producto_id.codigo }}</td>
        <td>{{ row.producto_id.nombre }}</td>
        <td>{{ row.producto_id.stock }}</td>
        <td>{{ row.producto_id.valor_costo }}</td>
        <td>{{ row.producto_id.valor_venta }}</td>
        {% if row.producto_id.imagen %}
        <td> <img src="/media/{{ row.producto_id.imagen }}" class="img-fluid" style="max-width: 150px;">  </td>
        {% else %}
        <td> <img src="{% static 'img/nofoto.png' %}" class="img-fluid" style="max-width: 50px;"> </td>
        {% endif %}
        <td>{{ row.proveedor_id.razon_social }}</td>
        <td>{{ row.producto_id.descripcion }}</td>
        <td>
          <a id="{{row.producto_id.id}}" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#editarmodal" onclick="datos(this.id)"> Editar </a> 
          <a id="{{row.proveedor_id.id}}" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#eliminarmodal" onclick="datos2(this.id)">Borrar</a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center bg-warning">No hay productos registrados</td>
      </tr>
    </tbody>
    {% endfor %}
  </table>

  <!-- Modal Editar -->
  <div class="modal fade" id="editarmodal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
              <h4 class="modal-title">Editar Proveedor</h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">

              <form class="form" method="POST" id="formulario_editar_proveedor">
                {% csrf_token %}
                
          <div class="form-group">
            <label>Nombre del producto:</label>
            <input type="text" class="form-control" name="nombre" id="nombre_p" required>
            <div id="errornombre"></div>
          </div>

          <div class="form-group">
            <label>Cantidad en stock:</label>
            <input type="text" class="form-control" name="stock" id="stock_p" required>
            <div id="errorcantidad"></div>
          </div>

          <div class="form-group">
            <label>Valor costo:</label>
            <input type="text" class="form-control" name="valor_costo" id="valor_costo_p" required>
            <div id="errorvalor_costo"></div>
          </div>

          <div class="form-group">
            <label>Valor venta:</label>
            <input type="text" class="form-control" name="valor_venta" id="valor_venta_p" required>
            <div id="errorvalor_venta"></div>
          </div>


          <div class="form-group">
            <label>descripción del producto (opcional):</label>
            <input type="text" class="form-control" name="descripcion" id="descripcion_p">
          </div>

                 <div class="form-group">
                  <label>imagen:</label>
                  <input type="file" name="imagen" class="filestyle" data-buttonText="Select a File">
                  <div id="errorimagen"></div>
                </div>

                <div class="form-group">
                  <select class="form-control" name='usuario_proveedor' >
                    <option value="0" >Seleccionar</option>
                    {% for row in usuario_proveedor %}
                      <option value="{{ row.id }}"> {{ row.proveedor_id.razon_social }} </option>
                    {% endfor %}
                  </select>
                </div>


                <button class="save btn btn-primary" type="submit">Guardar</button>
                <br><br>
            </form>

            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
              <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>

      </div>
    </div>
  </div>

  <!-- Modal Editar -->
  <div class="modal fade" id="eliminarmodal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
              <h4 class="modal-title">Eliminar Proveedor</h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">

              <div id="id_p2" hidden="false"></div>
              <p id="mensaje2"></p>
              <button class="save btn btn-danger" type="submit" onclick="Eliminar()">Eliminar</button> <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>

            </div>

      </div>
    </div>
  </div>

 {% endblock %}

 {% block javascript %}
 <script>
    function datos(id) {

        console.log(id);
        var csrftoken = '{{ csrf_token }}';
        $.ajax({
          headers: {'X-CSRF-TOKEN': csrftoken},
          method: "GET",
          url: '/proveedores/editar/'+id+'/',
          dataType: 'json',
          data: { "csrfmiddlewaretoken": csrftoken,
              "id": id }
        })

        .done(function(response){
          console.log(response);
          var res = response;

          $('#nombre_p').val(res.nombre);
          $('#stock_p').val(res.stock);
          $('#valor_costo_p').val(res.valor_costo);
          $('#valor_venta_p').val(res.valor_venta);
          $('#descripcion_p').val(res.descripcion);
          $('#imagen_p').val(res.imagen);
          &('#proveedor_p').val(res.proveedor);
          
        });
      }
</script>
 {% endblock %} 