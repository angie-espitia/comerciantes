{% extends 'app/base_app.html' %}
{% block title %} Inicio {% endblock %}

{%  block content %}

 <h1 class="mt-4">Lista de proveedores</h1>

 <table class="table table-striped table-bordered">

 	<br>
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Razón social</th>
        <th>teléfono</th>
        <th>dirección</th>
        <th>celular</th>
        <th>email</th>
        <th>Acciones</th>
      </tr>
    </thead>
    {% for row in usuario_proveedor %}
    td
    <tbody>
      <tr>
        <td>{{ row.proveedor_id.nombre }}<div id="id" hidden="false">{{row.proveedor_id.id}}</div></td>
        <td>{{ row.proveedor_id.razon_social }}</td>
        <td>{{ row.proveedor_id.telefono }}</td>
        <td>{{ row.proveedor_id.direccion }}</td>
        <td>{{ row.proveedor_id.celular }}</td>
        <td>{{ row.proveedor_id.email }}</td>
        <td>
          <a class="btn btn-primary" href="{% url 'editar_proveedor' pk=row.proveedor_id.id %}"  data-toggle="modal" data-target="#editarmodal" onclick="datos()">Editar</a> 
          <a class="btn btn-danger" href="#"  data-toggle="modal" data-target="#eliminarmodal">Borrar</a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center bg-warning">No hay proveedores registrados</td>
      </tr>
    </tbody>
    {% endfor %}
  </table>

  <!-- Modal Editar -->
  <div class="modal fade" id="editarmodal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
<!-- 
        {% include "app/proveedor/edit_view.html" %} -->

            <!-- Modal Header -->
            <div class="modal-header">
              <h4 class="modal-title">Editar Proveedor</h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">

              <form class="form" method="POST" id="formulario_editar_proveedor">
                {% csrf_token %}
                
                
                <div class="form-group">
                  <label>Nombre de contácto:</label>
                  <input type="text" class="form-control" id="nombre_p">
                  <div id="errornombre"></div>
                </div>

                <div class="form-group">
                  <label>razon social:</label>
                  <input type="text" class="form-control" id="razon_social_p" required>
                </div>

                <div class="form-group">
                  <label>direccion:</label>
                  <input type="text" class="form-control" id="direccion_p">
                </div>

                <div class="form-group">
                  <label>email:</label>
                  <input type="text" class="form-control" id="email_p">
                  <div id="erroremail"></div>
                </div>

                <div class="form-group">
                  <label>telefono:</label>
                  <input type="text" class="form-control" id="telefono_p">
                  <div id="errortelefono"></div>
                </div>

                <div class="form-group">
                  <label>celular:</label>
                  <input type="text" class="form-control" id="celular_p">
                  <div id="errorcelular"></div>
                </div>


                  <button class="save btn btn-primary" type="submit">Guardar</button>
                  <br><br>
              </form>

            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
              <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>

      </div>
    </div>
  </div>

 {% endblock %}

 {% block javascript %}
 <script>
 function datos() {

        var id = $("#id").text();
        var csrftoken = '{{ csrf_token }}';

        $.ajax({
          headers: {'X-CSRF-TOKEN': csrftoken},
          method: "GET",
          url: '/proveedores/editar/'+id+'/',
          dataType: 'json',
          data: { "csrfmiddlewaretoken": csrftoken,
              "id": id }
        })

        .done(function(response){
          console.log(response);
          console.log(response.email);
          var res = response;
          var html = '<br>';
          
          $('#nombre_p').val(res.nombre);
          
        });
      }

      function Actualizar() {

        var id = $("#id").val();
        var nombre = $("#nombre2").val();
        var apellido = $("#apellido2").val();
        var cedula = $("#cedula2").val();
        var csrftoken = $('[name="csrfmiddlewaretoken"]').val();

        $.ajax({
          headers: {'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
          method: "POST",
          url: "/docentes/movmiento/act_guar/",
          dataType: 'json',
          data: { "csrfmiddlewaretoken": csrftoken,
              "id": id,
              "nombre": nombre,
              "apellido": apellido,
              "cedula": cedula }
        })

        .done(function(response){
          var res = response;
          
          location.reload();      
          
        });
      }
</script>
 {% endblock %} 