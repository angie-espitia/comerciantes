{% extends 'app/base_app.html' %}
{% load staticfiles %}
{% block title %} Liste de ventas {% endblock %}

{%  block content %}

<ul class="breadcrumb breadcrumbStyle">
  <li class="breadcrumb-item"><i class="fas fa-wallet"></i> Ventas</li>
  <li class="breadcrumb-item active">Lista de ventas</li>
</ul>

<h1 class="mt-4 text-center titleIniBox"><i class="fas fa-wallet"></i> Reportes de Ventas</h1>

<br>

<canvas id="myChart"></canvas>


 {% endblock %}

{% block javascript %}
<script src="{% static 'js/fecha_v.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.js"></script>
<script>

$(document).ready(function() {
    var nombreDeNegocio = $('#nameNegocio').text();
    var id = $('#usuario_id').text();
    // console.log(id);
    var csrftoken = '{{ csrf_token }}';
    $.ajax({
      headers: {'X-CSRF-TOKEN': csrftoken},
      method: "GET",
      url: '/ventas/lista/'+id+'/',
      dataType: 'json',
      data: { "csrfmiddlewaretoken": csrftoken,
          "id": id }
    })

    .done(function(response){
      // console.log(response);
      var res = response;
      if (JSON.stringify(res)=='{}'){
        html += '<tr><td colspan="4" class="text-center bg-warning">No hay ventas registradas</td></tr>';
      }
      else{
        array_reporte_fecha = {
          'mes' : [],
          'dia' : [],
          'anio' : [],
          'cantidad' : []
        };
        for(let item in res){
          var fecha_array = val_fecha(res[item].fecha).split(" ");
          array_reporte_fecha.mes.push(fecha_array[2]);
          array_reporte_fecha.dia.push(fecha_array[0]);
          array_reporte_fecha.anio.push(fecha_array[4]);
          array_reporte_fecha.cantidad.push(res[item].total);
        };

        // console.log(array_reporte_fecha);
        var item1 = '';
        var arrc = [];
        var arrd = [];
        for (let i = 0; i < array_reporte_fecha.mes.length; i++) {

          if(array_reporte_fecha.mes[i] == 'Noviembre'){
            item1 = 'Noviembre';
            arrc.push(array_reporte_fecha.cantidad[i]);
            arrd.push(array_reporte_fecha.dia[i]);

          };
        };

        console.log(item1);
        console.log(arrd);

        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: arrd,
                datasets: [{
                    label: item1,
                    backgroundColor: 'rgb(255, 99, 132)',
                    borderColor: '#fff',
                    data: arrc,
                    fill: false
                }]
            },

            options: {
              title: {
                  display: true,
              },
            }
        });
      }

    });
});

</script>
{% endblock %}
